# prom-exporter

Этот проект является приложением для экспорта метрик в Prometheus.

## О проекте (WIP)
Приложение запускает http-сервер для prometheus и контрибьюторов данных. 
У каждого контрибьютора должен быть свой обработчик, например, `./handlers/images_handler` - для парсера изображений. \
В нем реализованы метрики, которые необходимо прокидывать в prometheus. 

Нэйминг метрик:
- сами метрики называются по принципу `metricName` = `<приложение>_<названиеМетрики>`
- название ключа redis - название метрики с префиксом `prometheus:<metricName>`
- пример - метрика `successful_uploads_total` приложения `parser_images`, полное название метрики для дебага - `parser_images_successful_uploads_total`, 
- ключ в redis - `prometheus:parser_images_successful_uploads_total`

Для добавления новой метрики: ...<TBD> 

Для добавления нового контрибьютора: ...<TBD>

Основные метрики приложения доступны по адресу http://localhost:8200/metrics

## Переменные окружения

- `REDIS_SYNC_INTERVAL`: Интервал в секундах для сохранения метрик в Redis. Пример значения: `10`
- `PORT`: Порт, на котором будет запущен сервер. Пример значения: `8200`
- `REDIS_DSN`: Строка подключения к Redis. Пример значения: `redis://localhost:6379`
- `GIN_MODE`: Режим работы Gin (фреймворка для веб-приложений на Go). Пример значения: `release`. Возможные значения: `debug | release | test`.

## Установка зависимостей

Для установки зависимостей проекта выполните:

```bash
go mod download
```

## Локальный запуск

Проект может быть запущен с помощью следующей команды:

```bash
go run main.go
```

Либо в докере с помощью команд:
```bash
docker build -t prom-exporter . 
docker run -p 8200:8200 prom-exporter
```

## Сборка и production-запуск

Для сборки выполните:
```bash
go build
```

Запуск осуществляется через обращение к исполняемому файлу:
```bash
./prom-exporter
```

## Интеграция с Prometheus

Для интеграции с Prometheus, убедитесь, что вы добавили ваши метрики в коде и зарегистрировали их с помощью prometheus.MustRegister(). Затем, чтобы Prometheus мог собирать метрики, вы должны добавить конфигурацию в yml-манифест. Пример:
```yaml
scrape_configs:
  - job_name: 'prom-exporter'
    static_configs:
      - targets: ['localhost:8200']
```

## Развертывание
При развертывании данного приложения в среде DevOps, рекомендуется настроить следующие пункты:

* Поднимите Redis-сервер и настройте REDIS_DSN в соответствии с его адресом и портом.
* Настройте значение переменной REDIS_SYNC_INTERVAL в зависимости от частоты обновления метрик, которую вы хотите.